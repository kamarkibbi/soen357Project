{"ast":null,"code":"import { __assign } from \"tslib\";\nimport dateutil from '../dateutil';\nimport { empty, repeat, pymod, includes } from '../helpers';\nimport { M365MASK, MDAY365MASK, NMDAY365MASK, WDAYMASK, M365RANGE, M366MASK, MDAY366MASK, NMDAY366MASK, M366RANGE } from '../masks';\nexport function rebuildYear(year, options) {\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var nextyearlen = dateutil.isLeapYear(year + 1) ? 366 : 365;\n  var yearordinal = dateutil.toOrdinal(firstyday);\n  var yearweekday = dateutil.getWeekday(firstyday);\n  var result = __assign(__assign({\n    yearlen: yearlen,\n    nextyearlen: nextyearlen,\n    yearordinal: yearordinal,\n    yearweekday: yearweekday\n  }, baseYearMasks(year)), {\n    wnomask: null\n  });\n  if (empty(options.byweekno)) {\n    return result;\n  }\n  result.wnomask = repeat(0, yearlen + 7);\n  var firstwkst;\n  var wyearlen;\n  var no1wkst = firstwkst = pymod(7 - yearweekday + options.wkst, 7);\n  if (no1wkst >= 4) {\n    no1wkst = 0;\n    // Number of days in the year, plus the days we got\n    // from last year.\n    wyearlen = result.yearlen + pymod(yearweekday - options.wkst, 7);\n  } else {\n    // Number of days in the year, minus the days we\n    // left in last year.\n    wyearlen = yearlen - no1wkst;\n  }\n  var div = Math.floor(wyearlen / 7);\n  var mod = pymod(wyearlen, 7);\n  var numweeks = Math.floor(div + mod / 4);\n  for (var j = 0; j < options.byweekno.length; j++) {\n    var n = options.byweekno[j];\n    if (n < 0) {\n      n += numweeks + 1;\n    }\n    if (!(n > 0 && n <= numweeks)) {\n      continue;\n    }\n    var i = void 0;\n    if (n > 1) {\n      i = no1wkst + (n - 1) * 7;\n      if (no1wkst !== firstwkst) {\n        i -= 7 - firstwkst;\n      }\n    } else {\n      i = no1wkst;\n    }\n    for (var k = 0; k < 7; k++) {\n      result.wnomask[i] = 1;\n      i++;\n      if (result.wdaymask[i] === options.wkst) break;\n    }\n  }\n  if (includes(options.byweekno, 1)) {\n    // Check week number 1 of next year as well\n    // orig-TODO : Check -numweeks for next year.\n    var i = no1wkst + numweeks * 7;\n    if (no1wkst !== firstwkst) i -= 7 - firstwkst;\n    if (i < yearlen) {\n      // If week starts in next year, we\n      // don't care about it.\n      for (var j = 0; j < 7; j++) {\n        result.wnomask[i] = 1;\n        i += 1;\n        if (result.wdaymask[i] === options.wkst) break;\n      }\n    }\n  }\n  if (no1wkst) {\n    // Check last week number of last year as\n    // well. If no1wkst is 0, either the year\n    // started on week start, or week number 1\n    // got days from last year, so there are no\n    // days from last year's last week number in\n    // this year.\n    var lnumweeks = void 0;\n    if (!includes(options.byweekno, -1)) {\n      var lyearweekday = dateutil.getWeekday(new Date(Date.UTC(year - 1, 0, 1)));\n      var lno1wkst = pymod(7 - lyearweekday.valueOf() + options.wkst, 7);\n      var lyearlen = dateutil.isLeapYear(year - 1) ? 366 : 365;\n      var weekst = void 0;\n      if (lno1wkst >= 4) {\n        lno1wkst = 0;\n        weekst = lyearlen + pymod(lyearweekday - options.wkst, 7);\n      } else {\n        weekst = yearlen - no1wkst;\n      }\n      lnumweeks = Math.floor(52 + pymod(weekst, 7) / 4);\n    } else {\n      lnumweeks = -1;\n    }\n    if (includes(options.byweekno, lnumweeks)) {\n      for (var i = 0; i < no1wkst; i++) result.wnomask[i] = 1;\n    }\n  }\n  return result;\n}\nfunction baseYearMasks(year) {\n  var yearlen = dateutil.isLeapYear(year) ? 366 : 365;\n  var firstyday = new Date(Date.UTC(year, 0, 1));\n  var wday = dateutil.getWeekday(firstyday);\n  if (yearlen === 365) {\n    return {\n      mmask: M365MASK,\n      mdaymask: MDAY365MASK,\n      nmdaymask: NMDAY365MASK,\n      wdaymask: WDAYMASK.slice(wday),\n      mrange: M365RANGE\n    };\n  }\n  return {\n    mmask: M366MASK,\n    mdaymask: MDAY366MASK,\n    nmdaymask: NMDAY366MASK,\n    wdaymask: WDAYMASK.slice(wday),\n    mrange: M366RANGE\n  };\n}","map":{"version":3,"names":["dateutil","empty","repeat","pymod","includes","M365MASK","MDAY365MASK","NMDAY365MASK","WDAYMASK","M365RANGE","M366MASK","MDAY366MASK","NMDAY366MASK","M366RANGE","rebuildYear","year","options","firstyday","Date","UTC","yearlen","isLeapYear","nextyearlen","yearordinal","toOrdinal","yearweekday","getWeekday","result","__assign","baseYearMasks","wnomask","byweekno","firstwkst","wyearlen","no1wkst","wkst","div","Math","floor","mod","numweeks","j","length","n","i","k","wdaymask","lnumweeks","lyearweekday","lno1wkst","valueOf","lyearlen","weekst","wday","mmask","mdaymask","nmdaymask","slice","mrange"],"sources":["../../../src/iterinfo/yearinfo.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}