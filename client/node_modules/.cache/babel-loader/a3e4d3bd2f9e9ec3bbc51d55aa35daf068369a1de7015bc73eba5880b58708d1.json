{"ast":null,"code":"import dateutil from '../dateutil';\nimport { notEmpty, repeat, range, isPresent } from '../helpers';\nimport { Frequency } from '../types';\nimport { rebuildYear } from './yearinfo';\nimport { rebuildMonth } from './monthinfo';\nimport { easter } from './easter';\nimport { Time } from '../datetime';\n// =============================================================================\n// Iterinfo\n// =============================================================================\nvar Iterinfo = /** @class */function () {\n  // eslint-disable-next-line no-empty-function\n  function Iterinfo(options) {\n    this.options = options;\n  }\n  Iterinfo.prototype.rebuild = function (year, month) {\n    var options = this.options;\n    if (year !== this.lastyear) {\n      this.yearinfo = rebuildYear(year, options);\n    }\n    if (notEmpty(options.bynweekday) && (month !== this.lastmonth || year !== this.lastyear)) {\n      var _a = this.yearinfo,\n        yearlen = _a.yearlen,\n        mrange = _a.mrange,\n        wdaymask = _a.wdaymask;\n      this.monthinfo = rebuildMonth(year, month, yearlen, mrange, wdaymask, options);\n    }\n    if (isPresent(options.byeaster)) {\n      this.eastermask = easter(year, options.byeaster);\n    }\n  };\n  Object.defineProperty(Iterinfo.prototype, \"lastyear\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastyear : null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"lastmonth\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastmonth : null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearlen\", {\n    get: function () {\n      return this.yearinfo.yearlen;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearordinal\", {\n    get: function () {\n      return this.yearinfo.yearordinal;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mrange\", {\n    get: function () {\n      return this.yearinfo.mrange;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wdaymask\", {\n    get: function () {\n      return this.yearinfo.wdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mmask\", {\n    get: function () {\n      return this.yearinfo.mmask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wnomask\", {\n    get: function () {\n      return this.yearinfo.wnomask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nwdaymask\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.nwdaymask : [];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nextyearlen\", {\n    get: function () {\n      return this.yearinfo.nextyearlen;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mdaymask\", {\n    get: function () {\n      return this.yearinfo.mdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nmdaymask\", {\n    get: function () {\n      return this.yearinfo.nmdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Iterinfo.prototype.ydayset = function () {\n    return [range(this.yearlen), 0, this.yearlen];\n  };\n  Iterinfo.prototype.mdayset = function (_, month) {\n    var start = this.mrange[month - 1];\n    var end = this.mrange[month];\n    var set = repeat(null, this.yearlen);\n    for (var i = start; i < end; i++) set[i] = i;\n    return [set, start, end];\n  };\n  Iterinfo.prototype.wdayset = function (year, month, day) {\n    // We need to handle cross-year weeks here.\n    var set = repeat(null, this.yearlen + 7);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    var start = i;\n    for (var j = 0; j < 7; j++) {\n      set[i] = i;\n      ++i;\n      if (this.wdaymask[i] === this.options.wkst) break;\n    }\n    return [set, start, i];\n  };\n  Iterinfo.prototype.ddayset = function (year, month, day) {\n    var set = repeat(null, this.yearlen);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    set[i] = i;\n    return [set, i, i + 1];\n  };\n  Iterinfo.prototype.htimeset = function (hour, _, second, millisecond) {\n    var _this = this;\n    var set = [];\n    this.options.byminute.forEach(function (minute) {\n      set = set.concat(_this.mtimeset(hour, minute, second, millisecond));\n    });\n    dateutil.sort(set);\n    return set;\n  };\n  Iterinfo.prototype.mtimeset = function (hour, minute, _, millisecond) {\n    var set = this.options.bysecond.map(function (second) {\n      return new Time(hour, minute, second, millisecond);\n    });\n    dateutil.sort(set);\n    return set;\n  };\n  Iterinfo.prototype.stimeset = function (hour, minute, second, millisecond) {\n    return [new Time(hour, minute, second, millisecond)];\n  };\n  Iterinfo.prototype.getdayset = function (freq) {\n    switch (freq) {\n      case Frequency.YEARLY:\n        return this.ydayset.bind(this);\n      case Frequency.MONTHLY:\n        return this.mdayset.bind(this);\n      case Frequency.WEEKLY:\n        return this.wdayset.bind(this);\n      case Frequency.DAILY:\n        return this.ddayset.bind(this);\n      default:\n        return this.ddayset.bind(this);\n    }\n  };\n  Iterinfo.prototype.gettimeset = function (freq) {\n    switch (freq) {\n      case Frequency.HOURLY:\n        return this.htimeset.bind(this);\n      case Frequency.MINUTELY:\n        return this.mtimeset.bind(this);\n      case Frequency.SECONDLY:\n        return this.stimeset.bind(this);\n    }\n  };\n  return Iterinfo;\n}();\nexport default Iterinfo;","map":{"version":3,"names":["dateutil","notEmpty","repeat","range","isPresent","Frequency","rebuildYear","rebuildMonth","easter","Time","Iterinfo","options","prototype","rebuild","year","month","lastyear","yearinfo","bynweekday","lastmonth","_a","yearlen","mrange","wdaymask","monthinfo","byeaster","eastermask","Object","defineProperty","get","yearordinal","mmask","wnomask","nwdaymask","nextyearlen","mdaymask","nmdaymask","ydayset","mdayset","_","start","end","set","i","wdayset","day","toOrdinal","Date","UTC","j","wkst","ddayset","htimeset","hour","second","millisecond","_this","byminute","forEach","minute","concat","mtimeset","sort","bysecond","map","stimeset","getdayset","freq","YEARLY","bind","MONTHLY","WEEKLY","DAILY","gettimeset","HOURLY","MINUTELY","SECONDLY"],"sources":["../../../src/iterinfo/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}