{"ast":null,"code":"import { freqIsDailyOrGreater } from '../types';\nimport dateutil from '../dateutil';\nimport Iterinfo from '../iterinfo/index';\nimport { RRule } from '../rrule';\nimport { buildTimeset } from '../parseoptions';\nimport { notEmpty, includes, isPresent } from '../helpers';\nimport { DateWithZone } from '../datewithzone';\nimport { buildPoslist } from './poslist';\nimport { DateTime } from '../datetime';\nexport function iter(iterResult, options) {\n  var dtstart = options.dtstart,\n    freq = options.freq,\n    interval = options.interval,\n    until = options.until,\n    bysetpos = options.bysetpos;\n  var count = options.count;\n  if (count === 0 || interval === 0) {\n    return emitResult(iterResult);\n  }\n  var counterDate = DateTime.fromDate(dtstart);\n  var ii = new Iterinfo(options);\n  ii.rebuild(counterDate.year, counterDate.month);\n  var timeset = makeTimeset(ii, counterDate, options);\n  for (;;) {\n    var _a = ii.getdayset(freq)(counterDate.year, counterDate.month, counterDate.day),\n      dayset = _a[0],\n      start = _a[1],\n      end = _a[2];\n    var filtered = removeFilteredDays(dayset, start, end, ii, options);\n    if (notEmpty(bysetpos)) {\n      var poslist = buildPoslist(bysetpos, timeset, start, end, ii, dayset);\n      for (var j = 0; j < poslist.length; j++) {\n        var res = poslist[j];\n        if (until && res > until) {\n          return emitResult(iterResult);\n        }\n        if (res >= dtstart) {\n          var rezonedDate = rezoneIfNeeded(res, options);\n          if (!iterResult.accept(rezonedDate)) {\n            return emitResult(iterResult);\n          }\n          if (count) {\n            --count;\n            if (!count) {\n              return emitResult(iterResult);\n            }\n          }\n        }\n      }\n    } else {\n      for (var j = start; j < end; j++) {\n        var currentDay = dayset[j];\n        if (!isPresent(currentDay)) {\n          continue;\n        }\n        var date = dateutil.fromOrdinal(ii.yearordinal + currentDay);\n        for (var k = 0; k < timeset.length; k++) {\n          var time = timeset[k];\n          var res = dateutil.combine(date, time);\n          if (until && res > until) {\n            return emitResult(iterResult);\n          }\n          if (res >= dtstart) {\n            var rezonedDate = rezoneIfNeeded(res, options);\n            if (!iterResult.accept(rezonedDate)) {\n              return emitResult(iterResult);\n            }\n            if (count) {\n              --count;\n              if (!count) {\n                return emitResult(iterResult);\n              }\n            }\n          }\n        }\n      }\n    }\n    if (options.interval === 0) {\n      return emitResult(iterResult);\n    }\n    // Handle frequency and interval\n    counterDate.add(options, filtered);\n    if (counterDate.year > dateutil.MAXYEAR) {\n      return emitResult(iterResult);\n    }\n    if (!freqIsDailyOrGreater(freq)) {\n      timeset = ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, 0);\n    }\n    ii.rebuild(counterDate.year, counterDate.month);\n  }\n}\nfunction isFiltered(ii, currentDay, options) {\n  var bymonth = options.bymonth,\n    byweekno = options.byweekno,\n    byweekday = options.byweekday,\n    byeaster = options.byeaster,\n    bymonthday = options.bymonthday,\n    bynmonthday = options.bynmonthday,\n    byyearday = options.byyearday;\n  return notEmpty(bymonth) && !includes(bymonth, ii.mmask[currentDay]) || notEmpty(byweekno) && !ii.wnomask[currentDay] || notEmpty(byweekday) && !includes(byweekday, ii.wdaymask[currentDay]) || notEmpty(ii.nwdaymask) && !ii.nwdaymask[currentDay] || byeaster !== null && !includes(ii.eastermask, currentDay) || (notEmpty(bymonthday) || notEmpty(bynmonthday)) && !includes(bymonthday, ii.mdaymask[currentDay]) && !includes(bynmonthday, ii.nmdaymask[currentDay]) || notEmpty(byyearday) && (currentDay < ii.yearlen && !includes(byyearday, currentDay + 1) && !includes(byyearday, -ii.yearlen + currentDay) || currentDay >= ii.yearlen && !includes(byyearday, currentDay + 1 - ii.yearlen) && !includes(byyearday, -ii.nextyearlen + currentDay - ii.yearlen));\n}\nfunction rezoneIfNeeded(date, options) {\n  return new DateWithZone(date, options.tzid).rezonedDate();\n}\nfunction emitResult(iterResult) {\n  return iterResult.getValue();\n}\nfunction removeFilteredDays(dayset, start, end, ii, options) {\n  var filtered = false;\n  for (var dayCounter = start; dayCounter < end; dayCounter++) {\n    var currentDay = dayset[dayCounter];\n    filtered = isFiltered(ii, currentDay, options);\n    if (filtered) dayset[currentDay] = null;\n  }\n  return filtered;\n}\nfunction makeTimeset(ii, counterDate, options) {\n  var freq = options.freq,\n    byhour = options.byhour,\n    byminute = options.byminute,\n    bysecond = options.bysecond;\n  if (freqIsDailyOrGreater(freq)) {\n    return buildTimeset(options);\n  }\n  if (freq >= RRule.HOURLY && notEmpty(byhour) && !includes(byhour, counterDate.hour) || freq >= RRule.MINUTELY && notEmpty(byminute) && !includes(byminute, counterDate.minute) || freq >= RRule.SECONDLY && notEmpty(bysecond) && !includes(bysecond, counterDate.second)) {\n    return [];\n  }\n  return ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, counterDate.millisecond);\n}","map":{"version":3,"names":["freqIsDailyOrGreater","dateutil","Iterinfo","RRule","buildTimeset","notEmpty","includes","isPresent","DateWithZone","buildPoslist","DateTime","iter","iterResult","options","dtstart","freq","interval","until","bysetpos","count","emitResult","counterDate","fromDate","ii","rebuild","year","month","timeset","makeTimeset","_a","getdayset","day","dayset","start","end","filtered","removeFilteredDays","poslist","j","length","res","rezonedDate","rezoneIfNeeded","accept","currentDay","date","fromOrdinal","yearordinal","k","time","combine","add","MAXYEAR","gettimeset","hour","minute","second","isFiltered","bymonth","byweekno","byweekday","byeaster","bymonthday","bynmonthday","byyearday","mmask","wnomask","wdaymask","nwdaymask","eastermask","mdaymask","nmdaymask","yearlen","nextyearlen","tzid","getValue","dayCounter","byhour","byminute","bysecond","HOURLY","MINUTELY","SECONDLY","millisecond"],"sources":["../../../src/iter/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}